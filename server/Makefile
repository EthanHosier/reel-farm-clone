# Makefile for Reel Farm Server

.PHONY: help pull-schema generate clean generate-api

help: ## Show this help message
	@echo 'Usage: make [target]'
	@echo ''
	@echo 'Targets:'
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  %-15s %s\n", $$1, $$2}' $(MAKEFILE_LIST)

pull-schema: ## Pull schema from database and generate SQLC code
	@echo "ðŸ”„ Pulling schema from database..."
	@./scripts/pull-schema.sh

generate: ## Generate SQLC code only (requires schema to exist)
	@echo "ðŸ”„ Generating SQLC code..."
	@sqlc generate
	@echo "âœ… SQLC code generated"

generate-api: ## Generate OpenAPI code
	@echo "ðŸ”„ Generating OpenAPI code..."
	@mkdir -p internal/api
	@go run github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen -config ../openapi/config.yaml ../openapi/api.yaml
	@echo "âœ… OpenAPI code generated"

clean: ## Clean generated files
	@echo "ðŸ§¹ Cleaning generated files..."
	@rm -rf db/
	@rm -f sql/schema/schema.sql
	@rm -f internal/api/generated.go
	@echo "âœ… Cleaned"

dev: ## Run development server
	@echo "ðŸš€ Starting development server..."
	@go run cmd/main.go

build: ## Build the application
	@echo "ðŸ”¨ Building application..."
	@go build -o bin/server cmd/main.go
	@echo "âœ… Built successfully"

test: ## Run tests
	@echo "ðŸ§ª Running tests..."
	@go test ./...

install-deps: ## Install dependencies
	@echo "ðŸ“¦ Installing dependencies..."
	@go mod download
	@go mod tidy
	@echo "âœ… Dependencies installed"
